## incomingOrders.createIncomingOrder: Создание онлайн-заказа

> Пример запроса:

```php
<?php
$url = 'https://joinposter.com/api/incomingOrders.createIncomingOrder'
 . '?token=687409:4164553abf6a031302898da7800b59fb';

$incoming_order = [
    'spot_id'   => 1,
    'phone'     => '+380680000000',
    'products'  => [
        [
            'product_id' => 169,
            'count'      => 1
        ],
    ],
];

$data = sendRequest($url, 'post', $incoming_order);
```

> Пример ответа:

```json
{  
  "response":{  
    "incoming_order_id":2,
    "spot_id":1,
    "status":0,
    "client_id":0,
    "first_name":null,
    "last_name":null,
    "phone":null,
    "email":null,
    "sex":null,
    "birthday":null,
    "address":null,
    "comment":null,
    "created_at":"2017-10-27 11:47:19",
    "updated_at":"2017-10-27 11:47:19",
    "transaction_id":null,
    "fiscal_spreading":0,
    "fiscal_method":"",
    "products":[  
      {  
        "io_product_id":2,
        "product_id":169,
        "modificator_id":null,
        "incoming_order_id":2,
        "count":1,
        "created_at":"2017-10-27 11:47:19"
      }
    ]
  }
}
```

> Пример запроса с автоприменением акций:

```php
<?php
$url = 'https://joinposter.com/api/incomingOrders.createIncomingOrder'
 . '?token=687409:4164553abf6a031302898da7800b59fb';

$incoming_order = [
    "spot_id"   => 1,
    "products"  => [
        [
            "product_id"    => 139,
            "count"         => 1
        ]
    ],
    "promotion" => [
        [
            "id" => 1, 
            "involved_products" => [
                ["id" => 139, "count"  => 1]
            ],
            "result_products"   => [
                ["id" => 161]
            ]
        ]
    ]
];

$data = sendRequest($url, 'post', $incoming_order);
```

> Пример ответа:

```json
{
  "response":{
    "incoming_order_id":"106",
    "type":"1",
    "spot_id":"1",
    "status":0,
    "client_id":0,
    "first_name":null,
    "last_name":null,
    "phone":null,
    "email":null,
    "sex":null,
    "birthday":null,
    "address":null,
    "comment":null,
    "created_at":"2017-12-06 18:45:06",
    "updated_at":"2017-12-06 18:45:06",
    "transaction_id":null,
    "fiscal_spreading":"0",
    "fiscal_method":"",
    "promotion":"[{\"id\":1,\"involved_products\":[{\"id\":139,\"count\":1}],\"result_products\":[{\"id\":161}]}]",
    "products":[
      {
        "io_product_id":"194",
        "product_id":"139",
        "modificator_id":null,
        "incoming_order_id":"106",
        "count":"1.00000",
        "created_at":"2017-12-06 18:45:06"
      }
    ]
  }
}
```


Метод создаёт онлайн-заказ

### HTTP POST запрос

`POST https://joinposter.com/api/incomingOrders.createIncomingOrder`

### POST-параметры запроса incomingOrders.createIncomingOrder

Параметр | Описание
-------- | --------
spot_id | Id заведения в которое придет онлайн заказ
client_id | Id клиента в Poster, если id не указан, то нужно передать параметр `phone`. Poster попробует найти клиента с таким же номером телефона и привяжет его к заказу. Если это новый клиент, то официант выберет для него группу и Poster создаст нового клиента. 
first_name | Имя клиента, по умолчанию не передаётся
last_name | Фамилия клиента, по умолчанию не передаётся
phone | Телефон клиента, обязательный параметр если не указан `client_id` 
email | Эл. почта, по умолчанию не передаётся
sex | Пол клиента: 0 — не указан, 1 — мужской, 2 — женский. По умолчанию не передаётся.
birthday | Дата рождения клиента, формат `Y-m-d`. По умолчанию не передаётся.
address | Адрес клиента, по умолчанию не передаётся
comment | Комментарий к онлайн-заказу, по умолчанию не передаётся
products | Список товаров
payment | Информация об оплате, по умолчанию не передаётся
promotion | Список акций которые нужно применить к заказу

Внутри параметра `products` должен быть массив, в каждом элементе которого должны быть следующие параметры:

Параметр | Описание
-------- | --------
product_id | Id товара
modificator_id | Id модификатора товара
modification | Модификации тех. карты, по умолчанию не передаётся
count | Обязательный параметр, количество товара
price | Цена товара в копейках, по умолчанию берется цена товара в указанном заведении

Внутри параметра `modification` должна быть JSON `строка`. JSON должен состоять из массива объектов, где в каждом объекте должны быть следующие параметры:

Параметр | Описание
-------- | --------
m | Id модификации тех. карты
a | Количество модификации тех. карты

Внутри параметра `payment` должен быть объект, внутри которого должны быть следующие параметры:

Параметр | Описание
-------- | --------
type | Признак, что была предварительная оплата: 0 — не была, 1 — была. По умолчанию принимает 0. 
sum | Сумма оплаты в копейках
currency | ISO код валюты оплаты, должен совпадать с валютой аккаунта, например: UAH — гривна, RUB — рубль, USD — доллар

!> Если предварительной оплаты не было в онлайн-заказе - массив `payment` в запросе не передавать.

Внутри параметра `promotion` находится массив объектов, внутри каждого объекта есть следующие параметры:

Параметр | Описание
-------- | --------
id | Id акции которую нужно применить 
involved_products | Массив товаров которые учавствую в акции.
result_products | Массив товаров которые являются результатом акции. Нужно передавать только в бонусных акциях.

В массиве `involved_products` лежат объекты со следующими свойствами:

Параметр | Описание
-------- | --------
id | Обязательный параметр, id товара который учавтсвует в акции
count | Обязательный параметр, кол-во товара которое учавтвует в акции
modification | Опциональный параметр, id модификации которая учавствует в акции


<aside class="info">
    Товары которые передаются в массиве `result_products` не нужно включать в заказ. 
    Терминал добавит их автоматически.
</aside>

В массиве `result_products` лежат объекты со следующими свойствами:

Параметр | Описание
-------- | --------
id | Обязательный параметр, id товара который нужно добавить в заказ как результат акции
count | Обязательный параметр, кол-во товара которое нужно добавить а заказ
modification | Опциональный параметр, id модификации которую нужно добавить как результат акции

### Параметры ответа incomingOrders.createIncomingOrder

Параметр | Описание
-------- | --------
response | Объект ответа

Внутри параметра `response` лежит объект, внутри которого есть следующие параметры:

Параметр | Описание
-------- | --------
incoming_order_id | Id онлайн-заказа
type | Тип заказа: 1 — онлайн-заказ, 2 — бронирование. Для этого метода всегда равен 2.
spot_id | Id заведения
status | Статус заказа: 0 — новый, 1 — принят, 7 — отменён
client_id | Id клиента
first_name | Имя клиента
last_name | Фамилия клиента
phone | Телефон клиента
email | Эл. почта клиента
sex | Пол клиента: 0 — не указан, 1 — мужской, 2 — женский
birthday | Дата рождения клиента, формат `Y-m-d`
address | Адрес клиента
comment | Комментарий к онлайн-заказу
created_at | Дата создания онлайн-заказа
updated_at | Дата изменения статуса онлайн-заказа
transaction_id | Id связанного чека
fiscal_spreading | Опциональный параметр. Признак, как отправлять товары на фискальный регистратор: 1 — отправлять только фискальные товары, 2 - отправлять все товары, 3 - не отправлять товары.
fiscal_method | Опциональный параметр, метод оплаты на фискальном регистраторе: cash – наличными, card — картой. По умолчанию cash.
products | Список товаров

Внутри параметра `products` лежит массив, в каждом элементе которого есть следующие параметры:

Параметр | Описание
-------- | --------
io_product_id | Id товара в онлайн-заказе
product_id | Id товара
modificator_id | Id модификатора товара
incoming_order_id | Id онлайн-заказа
count | Количество товара в онлайн-заказе
created_at | Дата добавления товара в онлайн-заказ
